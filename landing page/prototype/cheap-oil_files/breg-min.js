if(typeof BLOOMBERG==="undefined"||!BLOOMBERG){var BLOOMBERG={};(function(){BLOOMBERG.namespace=function(b){var a=[],d,c;a=b.split(".");d=BLOOMBERG;if(a[0]==="BLOOMBERG"){a.shift()}for(c=0;c<a.length;c++){if(typeof d[a[c]]==="undefined"){d[a[c]]={}}d=d[a[c]]}return d}})()}BLOOMBERG.browser=(navigator.appName==="Microsoft Internet Explorer")?"IE":"non-IE";if(BLOOMBERG.browser==="IE"&&typeof(window.location.hash)!="undefined"&&window.location.hash!=""&&window.location.hash!="#"){window.location.hash=window.location.hash}BLOOMBERG.namespace("global_var");(function(){var ns=BLOOMBERG.namespace("user");ns.gaTrackAcct=null;var initialized=false,logged_in=false,usesProxyApi=false;function user_logged_in(status){logged_in=status;var nav_reg_obj=$("#nav_register");logged_in?nav_reg_obj.hide():nav_reg_obj.show()}var user_credentials_expiry_period=365;ns.initalized=function(){return initialized};ns.logged_in=function(){return logged_in};var jsonpCall=function(method,url,data,callback){$.ajax({url:url,type:method,dataType:method==="GET"?"jsonp":"json",data:data,success:callback,error:function(){}})};var user_credentials=new function(){function reset_credential(credential_name){eraseCookie(credential_name);delete credentials_obj[credential_name]}function on_logout(){reset_credential("session_id");reset_credential("session_key");assign_anonymous_credentials()}function on_login(){sync_anonymous_credentials_expiry();BLOOMBERG.user.analytics.merge()}function sync_anonymous_credentials_expiry(){var remember_me=readBregCookie("remember_me"),expiry_period;if(remember_me==1){expiry_period=30}createCookie("session_id",credentials_obj.session_id,expiry_period,"bloomberg.com");createCookie("session_key",credentials_obj.session_key,expiry_period,"bloomberg.com")}function set_credential(credential_name,credential_value){credentials_obj[credential_name]=credential_value;createCookie(credential_name,credentials_obj[credential_name],user_credentials_expiry_period,"bloomberg.com")}function assign_anonymous_credentials(){var payload={};if(credentials_obj.agent_id){payload.agent_id=credentials_obj.agent_id}if(credentials_obj.session_id){payload.session_id=credentials_obj.session_id}if(credentials_obj.session_key){payload.session_key=credentials_obj.session_key}jsonpCall("GET",options.u+"/user_credentials/",payload,success_callback);function success_callback(response){if(!response){return}switch(response.status){case 201:set_credential("agent_id",response.agent_id);set_credential("session_id",response.session_id);set_credential("session_key",response.session_key);dispatch_user_info(response);break;default:break}}}function dispatch_user_info(credentials_obj){var userInfoObject={};var bconnect_id=readBregCookie("bconnect_id");if(bconnect_id){userInfoObject.breg=bconnect_id}$.extend(userInfoObject,credentials_obj);dispatchUserInfo();dispatchToResponders("userInfo",userInfoObject)}function add_responders(){BLOOMBERG.user.addResponder("login",on_login);BLOOMBERG.user.addResponder("logout",on_logout)}this.load_anonymous_credentials=function(){credentials_obj.agent_id=readCookie("agent_id");credentials_obj.session_id=readCookie("session_id");credentials_obj.session_key=readCookie("session_key");if(credentials_obj.agent_id&&credentials_obj.session_id&&credentials_obj.session_key){createCookie("agent_id",credentials_obj.agent_id,user_credentials_expiry_period,"bloomberg.com");if(!logged_in){createCookie("session_id",credentials_obj.session_id,user_credentials_expiry_period,"bloomberg.com");createCookie("session_key",credentials_obj.session_key,user_credentials_expiry_period,"bloomberg.com")}dispatch_user_info(credentials_obj)}else{assign_anonymous_credentials()}};this.init=function(){this.load_anonymous_credentials();add_responders();notifyClient("service",JSON.stringify({state:"ready"}))};var credentials_obj={}};ns.removeProxyFrame=function(frame){$(frame).remove()};var escapeHTML=function(s){var clean=s.replace(/&/g,"&amp;");clean=clean.replace(/</g,"&lt;");clean=clean.replace(/>/g,"&gt;");clean=clean.replace(/'/g,"&#x27;");clean=clean.replace(/"/g,"&quot;");clean=clean.replace(/\//g,"&#x2F;");return clean};var proxyCall=function(urlData){if(document.location.pathname==="/proxy/api"){urlData.api="bloomberg"}var iframe=document.createElement("iframe");iframe.style.display="none";iframe.style.width="0px";iframe.style.height="0px";iframe.src=options.u+"/proxy#"+$.param(urlData);$(iframe).load(function(){});$("#reg_proxy_container").append(iframe)};var notifyClient=function(event_type,message){var full_message="reg|"+event_type+"|"+message;if(parent.parent!==window){if(window.postMessage){parent.parent.postMessage(full_message,"*")}else{top.location.href=unescape(options.return_to)+"#"+full_message}}};function dispatchUserInfo(){var userInfo={email:readBregCookie("email"),logged_in:BLOOMBERG.user.logged_in(),name:readBregCookie("name")};notifyClient("user",JSON.stringify(userInfo))}function dispatchSessionInfo(){var sessionInfo={agent_id:readCookie("agent_id"),breg:readBregCookie("bconnect_id"),session_key:readCookie("session_key"),session_id:readCookie("session_id")};notifyClient("session",JSON.stringify(sessionInfo))}var responders={};ns.addResponder=function(event_type,f){var existing_responders=responders[event_type];if(typeof(existing_responders)=="undefined"){existing_responders=new Array()}existing_responders.push(f);responders[event_type]=existing_responders};var removeResponder=function(event_type,f){var existing_responders=responders[event_type];if(typeof(existing_responders=="undefined")){return}var total_responders=existing_responders.length;for(var i=0;i<total_responders;i++){var responder=existing_responders[i];if(responder==f){if(!Array.prototype.remove){Array.prototype.remove=function(from,to){var rest=this.slice((to||from)+1||this.length);this.length=from<0?this.length+from:from;return this.push.apply(this,rest)}}existing_responders.remove(i);return}}};var handleJson=function handleJson(fullMessage){var messageJson;try{messageJson=JSON.parse(fullMessage);usesProxyApi=location.pathname==="/proxy/api";if(messageJson.action==="login"){if(typeof messageJson.userid==="object"){var payload={password:messageJson.password.value};if(messageJson.userid.value.indexOf("@")==-1){payload.username=messageJson.userid.value}else{payload.email=messageJson.userid.value}BLOOMBERG.user.login(payload,false)}else{reg_ui.social_proxy(jQuery.Event(),{type:messageJson.provider+"_proxy"})}}else{if(messageJson.action==="logout"){BLOOMBERG.user.logout()}else{if(messageJson.action==="user"&&messageJson.type==="info"){dispatchUserInfo()}else{if(messageJson.action==="session"&&messageJson.type==="info"){dispatchSessionInfo()}else{if(messageJson.action==="check"){notifyClient("service",JSON.stringify({state:"ready"}))}}}}}}catch(error){}};var handleMessage=function(event){var full_message=event.data;var parts;handleJson(full_message);if(event.origin&&event.origin!=options.o){return}try{parts=full_message.split("|");if(parts[0]!="reg"){return}dispatchToResponders(parts[1],(parts.length<3?"":parts[2]))}catch(error){}};var dispatchToResponders=function(event_type,message){notifyClient(event_type,JSON.stringify(message));var existing_responders=responders[event_type];if(typeof(existing_responders)=="undefined"||existing_responders.length==0){return}var total_responders=existing_responders.length;for(var i=0;i<total_responders;i++){try{existing_responders[i].call(ns,event_type,message)}catch(exp){try{console.log(exp)}catch(expIgnored){}}}};var default_options={u:"https://login.bloomberg.com",mode:"iframe",enable_tracking_cookies:true,return_to:document.location.href,bcom_register_selector:".top_utility a.register",sign_in_text:"Sign In",sign_out_text:"Sign Out",sign_in_selector:"#login_navigation_item > a, .top_utility .sm_hide > a.sign_in",sign_in_container_selector:"#login_navigation_item",welcome_id:"reg_welcome",vertical_position:"bottom",horizontal_position:"right",width:290,height:275,poll_interval:100,create_hat:true,iframe:{skin:""}};var options={};var hideFrame=function(){var $sign_in_selector=$(options.sign_in_selector);if(typeof $sign_in_selector!=="undefined"&&$sign_in_selector!==null){$sign_in_selector.removeClass("active")}$("#registration_frame").remove();$(".active_hat").remove()};var showFrame=function(elem){var link_offset=elem.offset();var left_offset=link_offset.left-options.width-13+elem.outerWidth();var top_offset=link_offset.top+elem.outerHeight()+6;var iframe_html='<div id="registration_frame" class="loading" style="top:'+top_offset+"px;left:"+left_offset+'px" ><iframe scrolling="no" class="registration_iframe" frameborder="0" src="'+options.u+"/api/login?"+$.param(options.iframe)+"&"+$.param({rt:options.return_to})+"&cc="+Math.random()+'"></iframe></div>';$("body").append(iframe_html);var reskin_left_shift=(BLOOMBERG&&BLOOMBERG.global_var&&BLOOMBERG.global_var.reskin_global)?5:-4;var reskin_top_shift=(BLOOMBERG&&BLOOMBERG.global_var&&BLOOMBERG.global_var.reskin_global)?-9:0;if(options.create_hat){elem.clone().appendTo("body").css({position:"absolute",top:link_offset.top+reskin_left_shift,left:link_offset.left+reskin_top_shift,"z-index":"99999999"}).addClass("active_hat").append('<div class="hide_shadow"></div>');$(".active_hat").click(function(e){e.preventDefault()})}$("#registration_frame").fadeIn("fast");$("body").click(function(){hideFrame()});$("iframe.registration_iframe").load(function(){$("#registration_frame").removeClass("loading")})};var params=null;var urlParam=function(name){if(typeof params=="undefined"||params==null){params={};if(window.location.search!=""){var pairs=window.location.href.slice(window.location.href.indexOf("?")+1).split("&");for(var i=0;i<pairs.length;i++){var pair=pairs[i].split("=");params[pair[0]]=pair[1]}}}return params[name]};var isRegApp=false;var isFramed=false;var sameDomainAsReg=false;ns.init_user_credentials=function(user_options){options=$.extend(true,options,default_options,user_options);user_credentials.load_anonymous_credentials()};ns.init=function(user_options){if(initialized){return}isFramed=parent!=window;if(typeof(user_options)=="undefined"){user_options={}}options=$.extend(true,options,default_options,user_options);if(typeof user_options.return_to=="undefined"&&isRegApp){options.return_to=urlParam("rt")}var origin_parts=options.u.split("/",3);options.o=origin_parts[0]+"//"+origin_parts[2];isRegApp=window.location.href.indexOf(options.u)!=-1;ns.service_uri=function(){options.u};$(document).ready(function(){function run_welcome_message(message_html){window.location.hash="_";var styles_str='<style type="text/css">#welcome_new_user_message{display:none;background:url(/images/registration/welcome_background.png) repeat-x;z-index:999999999; width:100%; padding:0; position:absolute; left:0; top:0;}#welcome_new_user_message .close{float:right; padding:5px; color:red; font-weight:bold;}#welcome_new_user_message .internal_welcome{width:970px;height:58px; line-height:50px; background:url(/images/registration/welcome_check_new_24.png) no-repeat 5px 10px; _background:url(/images/registration/welcome_check_new.png) no-repeat 5px 10px; padding: 0; font-size:18px; color:#333; margin:0 auto 0;text-align: left; text-indent:50px;}#welcome_new_user_message .shadow_welcome{width:100%; height:15px; background:url(/images/registration/welcome_shadow.png) repeat-x 0 0; _display:none; border-top:1px solid #999999;}</style>';var welcome_div='<div id="welcome_new_user_message"><a href="#" class="close"><img src="/images/registration/welcome_close.png" border="0" width="9" height="9" /></a><div class="internal_welcome">'+message_html+'</div><div class="shadow_welcome"></div></div>';$("body").append(styles_str+welcome_div);$("#welcome_new_user_message a.close").click(function(e){e.preventDefault();$("#welcome_new_user_message").slideUp("fast",function(){$(this).remove()})});$("#welcome_new_user_message").slideDown("slow");setTimeout("$('#welcome_new_user_message').slideUp('fast', function(){ $(this).remove(); });",15000)}switch(window.location.hash){case"#reg_nu":run_welcome_message('<a href="http://ad.doubleclick.net/clk;243854674;67550431;n;pc=[TPAS_ID]" id="hard_coded_ad" style="float:right; width:235px; margin:10px 0;  text-decoration:none; color:#333; margin:5px; font-size:11px; line-height:1em; text-align:left; text-indent:0;"><img src="http://login.bloomberg.com/images/ritzcarltonbutton.png" style="width:68px; height:47px; vertical-align:middle; float:right; border:none;" /><span style="float:left; margin:10px 0 0; width:160px;">Click here for an exclusive offer for Bloomberg.com Members</span></a><a href="http://ad.doubleclick.net/jump/N3753.bloomberg.com/B5600183.9;sz=1x1;pc=[TPAS_ID];ord=[timestamp]?"><img src="http://ad.doubleclick.net/ad/N3753.bloomberg.com/B5600183.9;sz=1x1;pc=[TPAS_ID];ord=[timestamp]?" border="0" width="1" height="1" ALT="Advertisement"></a>Your Bloomberg account has been created. <a href="'+options.u+'/account" style="color:#333; text-decoration:underline;">Manage your account here</a>.');break;case"#validate_email":run_welcome_message("Thanks for verifying your email address.");break;case"#validated_email":run_welcome_message("You have already confirmed your email address.");break;case"#password_reset_inst":run_welcome_message("Please check your email for password reset instructions.");break;case"#password_reset":run_welcome_message("Your password has been reset. Be sure to memorize and save it securely.");break;case"#deactivate_conf":run_welcome_message("Your account has been deleted.");break;case"#reactivate_account_ins":run_welcome_message("Instructions on how to reactivate your account have been sent to you.");break;case"#activate_account":run_welcome_message("Your account has been activated.");break;case"#unlock_account_ins":run_welcome_message("Instructions on how to unlock your account have been sent to you.");break;case"#unlock_account":run_welcome_message("Your account has been unlocked.");break;default:}if(!logged_in){$(options.sign_in_selector).text(options.sign_in_text)}if(!isFramed||$("#reg_proxy_container").length===0){var proxy_container=document.createElement("div");proxy_container.id="reg_proxy_container";$("body").append(proxy_container)}$("#bconnect_client_login_form a").click(function(){createCookie("return_to",options.return_to,1,"bloomberg.com");return true});$(".not_a_member a").click(function(){createCookie("return_to",options.return_to,1,"bloomberg.com");return true});$("#bconnect_client_login_form #new_user_session").submit(function(){var email=$("#bconnect_client_login_form form #user_session_email").val();var remember=$("#bconnect_client_login_form form #user_session_remember_me");var remember_me=remember[0].checked?remember.val():"0";var password=$("#bconnect_client_login_form form #user_session_password").val();var payload={password:password,remember_me:remember_me};BLOOMBERG.user.ga.events.record("Sign In","Submitted","bloomberg");if(email.indexOf("@")==-1){payload.username=email}else{payload.email=email}BLOOMBERG.user.login(payload,false);return false});if(window.postMessage){if(window.attachEvent){window.attachEvent("onmessage",handleMessage,false)}else{window.addEventListener("message",handleMessage,false)}}$(options.sign_in_selector).click(function(event){var $sign_in_selector=$(options.sign_in_selector);if(!logged_in){if(options.mode=="iframe"){if($sign_in_selector.hasClass("active")){hideFrame()}else{showFrame($sign_in_selector);$sign_in_selector.addClass("active")}}else{top.location.href=options.u+"/account"}}return false});BLOOMBERG.user.addResponder("logout",function(event_type,message){user_logged_in(false);if(!sameDomainAsReg){eraseCookies()}$("#registration_frame").remove();$(options.sign_in_container_selector+" #"+options.welcome_id).remove();$("#portofolio_link").remove();$(options.sign_in_selector).text(options.sign_in_text);$(options.sign_in_selector).show();$(".login_placeholder").hide();$(options.bcom_register_selector).show();try{BLOOMBERG.user.ga.events.record("Sign Out","Submitted")}catch(err){}});BLOOMBERG.user.addResponder("login",function(event_type,message){var data=message;var breg=message;if(typeof(message)!="string"){message=escapeHTML(data.user.name)}hideFrame();var menu_html='<div id="user_menu_logged_in"><a href="'+options.u+'/account">Account Settings</a><a href="'+options.u+'/account/alerts/settings">Alerts</a>';if(BLOOMBERG.user.feature_enabled("GP_NEWSLETTERS")){menu_html+='<a href="'+options.u+'/account/newsletters/settings">Newsletters</a>'}menu_html+='<a href="#" id="menu_signout">'+options.sign_out_text+"</a></div>";var port_watch_uri_html='<a href="'+BLOOMBERG.global_var.WATCHLIST_URL+'">Watchlist</a>';$(options.sign_in_container_selector).prepend('<div id="portofolio_link">'+port_watch_uri_html+'</div><div id="'+options.welcome_id+'">'+social_media_icon_html()+'<a href="#" id="user_menu_open">'+message+"</a>"+menu_html+"</div>");var enter_timer,leave_timer;function clear_timers(){if(leave_timer){clearTimeout(leave_timer);clearTimeout(enter_timer);leave_timer=null;enter_timer=null}}function open_tab(){var menu=$("#user_menu_logged_in");var menu_container=$("#reg_welcome");menu.toggle();menu_container.toggleClass("opened");if(menu.outerWidth()<menu_container.width()){menu.width(menu_container.width()-2)}}var tab=$("#user_menu_open"),drop=$("#user_menu_logged_in"),isiPad=navigator.userAgent&&(navigator.userAgent.match(/iPad/i)!=null),delay_leave=150,delay_enter=250;if(!isiPad){tab.mouseenter(function(){clear_timers();if(enter_timer){clearTimeout(enter_timer);enter_timer=null}enter_timer=setTimeout(function(){open_tab()},delay_enter)});drop.mouseenter(function(){clear_timers()})}else{tab.click(function(){$("#user_menu_logged_in").toggle();$("#reg_welcome").toggleClass("opened")})}$("#reg_welcome").mouseleave(function(){if(leave_timer){clearTimeout(leave_timer);leave_timer=null}if(enter_timer){clearTimeout(enter_timer);enter_timer=null}leave_timer=setTimeout(function(){$("#user_menu_logged_in").hide();$("#reg_welcome").removeClass("opened")},delay_leave)});$("#reg_welcome").click(function(e){e.stopPropagation()});$("body").click(function(e){$("#user_menu_logged_in").hide();$("#reg_welcome").removeClass("opened")});$("a#menu_signout").click(function(e){e.preventDefault();BLOOMBERG.user.logout()});$(options.sign_in_selector).hide();$(options.bcom_register_selector).hide();if(!sameDomainAsReg){createCookie("breg",breg)}user_logged_in(true)});var callVerify=!isRegApp;sameDomainAsReg=false;try{var hostname_only=options.u.split("/")[2].split(":")[0];var hostname_parts=hostname_only.split(".");var hl=hostname_parts.length;var reg_domain="."+hostname_parts[hl-2]+"."+hostname_parts[hl-1];sameDomainAsReg=window.location.hostname.indexOf(reg_domain)!=-1}catch(error){}if(callVerify&&sameDomainAsReg){callVerify=false;user_logged_in(readBregCookie("name")!=null);if(logged_in){if(readBregCookie("migrated")=="true"){BLOOMBERG.user.logout()}var new_session=(readCookie("session_breg")==null);if(new_session){BLOOMBERG.user.addResponder("after_revalidate_breg",function(event_type,raw_data){var name=readBregCookie("name");if(name!==null){dispatchToResponders("login",readBregCookie("name").slice(0,34))}});proxyCall({type:"POST",url:options.u+"/api/sso/revalidate_breg",event_type:"after_revalidate_breg"})}else{dispatchToResponders("login",readBregCookie("name").slice(0,34))}}else{user_logged_in(false);eraseCookies()}}if(callVerify){BLOOMBERG.user.addResponder("verify",function(event_type,raw_data){if(typeof(JSON)!="undefined"&&typeof(JSON.parse)!="undefined"){data=JSON.parse(unescape(raw_data))}else{data=$.parseJSON(unescape(raw_data))}if(data.status==200){user_logged_in(true);if(!isRegApp&&!sameDomainAsReg){createCookie("breg",data.breg)}dispatchToResponders("login",data)}else{user_logged_in(false);eraseCookies();dispatchToResponders("logout","")}});proxyCall({type:"POST",url:options.u+"/api/sso/verify",event_type:"verify"})}else{logged_in=readBregCookie("name")!=null}user_credentials.init()})};function eraseCookies(){eraseCookie("breg");eraseCookie("sbreg");eraseCookie("session_breg");eraseCookie("return_to");eraseCookie("force_re_auth");if(!isOBGuser()){eraseCookie("USID")}}function social_media_icon_html(){var login_type=readBregCookie("user_login_type");if(login_type==="bloomberg"){return""}else{return'<div class="icon '+login_type+'"></div>'}}function createCookie(name,value,days,domain,secure){var expires="";var dom="";if(days){var date=new Date();date.setTime(date.getTime()+(days*24*60*60*1000));expires="; expires="+date.toGMTString()}if(domain){dom="; domain="+domain}if(secure==true){document.cookie=name+"="+value+expires+dom+"; path=/; secure;"}else{document.cookie=name+"="+value+expires+dom+"; path=/; "}}ns.createCookie=createCookie;function readSBregCookie(name){var sbreg_cookie_value=readCookie("sbreg");if(sbreg_cookie_value==null){return null}var tokens=sbreg_cookie_value.split(":");var value;switch(name){case"bconnect_user_id":value=tokens[0];break;case"bconnect_user_key":value=tokens[1];break}return value}function isOBGuser(){var btog_cookie_value=readCookie("BTOG");return((btog_cookie_value!==null)&&(btog_cookie_value.search(/nrg2/)!==-1))}function readBregCookie(name){var breg_cookie_value=readCookie("breg");if(breg_cookie_value==null){return null}var tokens=breg_cookie_value.split(":");var value;switch(name){case"bconnect_id":value=tokens[0];break;case"name":value=tokens[1];break;case"remember_me":value=tokens[2];break;case"user_login_type":value=tokens[3];break;case"social_media_id":value=tokens[4];break;case"migrated":value=tokens[5];break;case"email_validated":value=tokens[6];break;case"deprecated01":value=tokens[7];break;case"deprecated02":value=tokens[8];break;case"test_plan_hash":value=tokens[9];if(typeof(value)!="undefined"){value=value.replace(/\^/g,":")}break;case"email":value=tokens[10];break;case"unlimited_usage":value=tokens[11];break}if(typeof(value)==="undefined"){return value}else{return value.replace(/\+/g," ")}}function readCookie(name){var nameEQ=name+"=";var ca=document.cookie.split(";");for(var i=0;i<ca.length;i++){var c=ca[i];while(c.charAt(0)==" "){c=c.substring(1,c.length)}if(c.indexOf(nameEQ)==0){return unescape(c.substring(nameEQ.length,c.length))}}return null}var Cookie=BLOOMBERG.namespace("util.Cookie");if(typeof Cookie.get==="undefined"){Cookie.get=readCookie}if(typeof Cookie.set==="undefined"){Cookie.set=createCookie}function eraseCookie(name){createCookie(name,"",-1,"bloomberg.com")}var storeLocation=function(uri){createCookie("return_to",uri,1,"bloomberg.com")};var afterLogin=function(data,make_proxy_call,callback){if(data.status==200){user_logged_in(true);if(!isRegApp&&!sameDomainAsReg){createCookie("breg",data.breg)}if(make_proxy_call){proxyCall({url:options.u+"/api/sso/login",type:"POST",data:{bconnect_user_id:data.user.bconnect_user_id,bconnect_user_key:data.bconnect_user_key},return_to:options.return_to})}var user_name=readBregCookie("name");user_name=escapeHTML(user_name).slice(0,34);dispatchUserInfo();notifyClient("login",user_name);if(typeof(callback)!="undefined"){callback.call(null,data)}}else{if(data.status==403){top.location.href=unescape(options.return_to)}else{if(usesProxyApi){notifyClient("login",JSON.stringify(data))}else{if(isFramed){storeLocation(options.return_to)}if(typeof(data.rt)!="undefined"){top.location.href=data.rt}}}}};ns.login=function(parameters,make_proxy_call,callback){make_proxy_call=typeof(make_proxy_call)!="undefined"?make_proxy_call:true;jsonpCall("POST",options.u+"/api/login",{user_session:parameters},function(data){if(data.status==200){BLOOMBERG.user.ga.events.record("Sign In","Success")}afterLogin(data,make_proxy_call,callback)})};ns.logout=function(){proxyCall({url:options.u+"/api/sso/logout",type:"POST",event_type:"logout",return_to:options.return_to})};ns.verifyUser=function(){var resp=function(event_type,raw_data){data=$.parseJSON(unescape(raw_data));if(data.status==200){dispatchToResponders("verifyUser",true)}else{user_logged_in(false);eraseCookies();dispatchToResponders("verifyUser",false)}BLOOMBERG.user.removeResponse("verifyUser",resp)};BLOOMBERG.user.addResponder("verifyUser",resp);proxyCall({type:"POST",url:options.u+"/api/sso/verify",event_type:"verifyUser"})};ns.loginOrLinkSocialUser=function(social_type,social_id,first_name,last_name){var payload={};payload.social_media_name=social_type;payload.social_media_id=social_id;payload.first_name=first_name;payload.last_name=last_name;if(logged_in){ns.linkSocialUser(payload)}else{BLOOMBERG.user.ga.events.record("Sign In","Submitted",social_type);ns.login(payload,isFramed,function(data){if(!isFramed){window.location.href=options.u+"/account"}})}};var s_names={facebook:"Facebook",twitter:"Twitter",linkedin:"LinkedIn",yahoo:"Yahoo!",google:"Google"};ns.linkSocialUser=function(payload){if(!isRegApp){return false}jsonpCall("POST",options.u+"/api/social/link",{user:payload},function(data){var socialSite=data.socialSite;if(data.status==200){var socialUserId=data.socialUserId;BLOOMBERG.user.ga.events.record("Social Integration","Link",socialSite);socialAccounts[data.socialSite]=socialUserId;$("#"+socialSite).html('<div><div class="social_icon"></div><span class="social_name_text">Linked to '+s_names[socialSite]+' <a href="#unlink_'+socialSite+'" class="unlink" rel="unlink" title="Unlink">unlink</a></span></div>')}else{if(data.status==409){alert("Your "+s_names[socialSite]+" account has already been linked to another Bloomberg Account.")}else{alert("An unexpected error occurred. Please try again later.\n\n"+data.error+"\n"+data.message)}}})};ns.unlinkSocialUser=function(social_type,social_id){var payload={};payload.social_media_name=social_type;payload.social_media_id=social_id;jsonpCall("POST",options.u+"/api/social/unlink",{user:payload},function(data){if(data.status==200){BLOOMBERG.user.ga.events.record("Social Integration","Unlink",social_type);delete (socialAccounts[data.socialSite]);$("#"+social_type).html('<a href="#'+social_type+'_proxy" rel="proxy"><div class="social_icon"></div><span class="social_name_text">Link to '+s_names[social_type]+"</span></a>")}else{alert(data.error+"\n"+data.message)}})};ns.email_validated=function(){return readBregCookie("email_validated")=="true"};ns.is_registered_user=function(){return readCookie("breg")};function get_test_plan_feature_value(feature_name,property_name,default_value){var ret=default_value;if(typeof(feature_name)!="undefined"){try{var hash=eval("("+readBregCookie("test_plan_hash")+")");ret=hash[feature_name][property_name]}catch(exp){}}return ret}ns.feature_enabled=function(feature_name){return get_test_plan_feature_value(feature_name,"enabled",false)};ns.subscribed_to_feature=function(feature_name){return get_test_plan_feature_value(feature_name,"subbed",false)};ns.is_alerts_enabled=function(){return get_test_plan_feature_value("BREAKING_NEWS","enabled",false)};ns.email_validated_and_subscribed_to_bn=function(){return ns.email_validated()&&get_test_plan_feature_value("BREAKING_NEWS","subbed",false)};ns.getEmail=function(){return readBregCookie("email")};ns.isUnlimitedUsage=function(){return readBregCookie("unlimited_usage")==="true"};ns.getBConnectId=function(){return readBregCookie("bconnect_id")||""};ns.subscribe=function(feature_name,success_callback,logged_in_but_failed_callback,not_logged_in_callback){var eventName="subscribe_alerts_"+new Date().getTime();ns.addResponder(eventName,function(event_type,rawData){var data=JSON.parse(unescape(rawData));if(data.logged_in){if(data.success){if(success_callback){success_callback(data)}}else{if(logged_in_but_failed_callback){logged_in_but_failed_callback(data)}}}else{if(not_logged_in_callback){not_logged_in_callback(data)}}});proxyCall({type:"POST",url:options.u+"/api/sso/subscribe/"+feature_name,event_type:eventName,api:"bloomberg"})}})();(function(){var a=BLOOMBERG.namespace("user.url");a.params=function(){var b={};var e=window.location.search;if(e.length>0){var f=e.split("?")[1].split("&");for(var d=0;d<f.length;d++){var c=f[d].split("=");b[c[0]]=c[1]}}return b}})();(function(){Date.nextYear=function(){var a=new Date();return new Date(a.getFullYear()+1,a.getMonth(),a.getDate(),a.getHours(),a.getMinutes(),a.getSeconds(),a.getMilliseconds())}})();(function(){var a=BLOOMBERG.namespace("user.cookie");a.setCookie=function(d,f,c,g,e){var c=new Date(c),b;if(c){b="; expires="+c.toGMTString()}else{b=""}if(typeof g==="undefined"){g="; path=/"}else{g="; path="+g}if(typeof e==="undefined"){e=""}else{e="; domain="+e}document.cookie=d+"="+f+b+g+e};a.setEndOfSessionCookie=function(c,e,f,d){var b;b="";if(typeof f==="undefined"){f="; path=/"}else{f="; path="+f}if(typeof d==="undefined"){d=""}else{d="; domain="+d}document.cookie=c+"="+e+b+f+d};a.getCookieValue=function(b){var c=document.cookie.match("(^|;) ?"+b+"=([^;$]*)");if(c){return c[2]}return""}})();(function(){var c=BLOOMBERG.namespace("user.analytics");var f=BLOOMBERG.user.cookie;var e=BLOOMBERG.user;var g="https:"===document.location.protocol?"https":"http";var d="last_merge_req";var a=g+"://tracking.bloomberg.com/images/tracking-pixel.gif";function b(h,i,l){if(h===""||i===""){return}var k=i+"|"+h;var j=f.getCookieValue(d);if(k===j){return}l();f.setEndOfSessionCookie(d,k,"/","bloomberg.com")}c.merge=function(){var h=e.getBConnectId();var i=f.getCookieValue("session_id");b(h,i,function(){$("<img/>",{src:a+"?interaction_type=merge&referrer="+document.referrer.replace("&","---"),title:"Analytics",id:"bb_analytics"})})};$(function(){c.merge()})}());